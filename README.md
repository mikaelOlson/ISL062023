# kodtest-template

Template for InfraSight Labs code test. Includes kodtest-server which provides a JSON REST API with data for the tests. 

## Build & Test

Building is driven by Maven (https://maven.apache.org) Use Java 11 (https://adoptium.net/temurin/releases/?version=11) when building with maven. Use JAVA_HOME to override which Java maven will use. Example in Windows:

```
set JAVA_HOME=C:\Program Files\Eclipse Adoptium\jdk-11.0.17.8-hotspot
```

First run validate to install bundled kodtest-server into local maven repository. Do this in the kodtest-template folder where pom.xml exists.

```
mvn validate
```

Then compile and run tests:

```
mvn test
```
This will spin up Kodtest-server accessible default on http://localhost:8080 and execute tests located in package `com.infrasight.kodtest` annotated with `@Test`.

## API documentation

To view the API documentation (generated by Swagger) you can run Kodtest-server manually from the kodtest-template folder.

First install bundled kodtest-server into local maven repository and compile the source:

```
mvn validate compile
```

Then start kodtest-server:

```
mvn exec:java -Dexec.args="--port=8080 --apiUser=apiUser --apiPassword=apiPassword!"
```

Access the API documentation by browsing to <b>http://localhost:port</b>. When running kodtest-server manually it may interfere with the server started by the tests so make sure you run them on different ports. You can change the port with option <b>port</b>.

Swagger also allows you to test the endpoints by clicking 'Try it out' and then 'Execute'.

### API authentication

Kodtest-server API is protected and requires authentication. Use values of options <b>apiUser</b> and <b>apiPassword</b> and authenticate towards http://localhost:8080/api/auth. The auth endpoint will return a token for a successful authentication. This token should then be set in the `Authorization` header for requests to the accounts, groups and relationship endpoints.

Kodtest-server uses simple bearer token authentication with the syntax: 

```
Bearer mytoken
```

When entering the token in the Swagger-UI do not include "Bearer ". Only enter the token. Swagger automatically adds the Bearer prefix. When you add the header manually you will need to include the Bearer prefix yourself.

## Writing JUnit Tests

JUnit tests are placed in package `com.infrasight.kodtest`. Every class containing test methods must extend `com.infrasight.kodtest.TestsSetup` and every test method must be annotated with `@Test` to be run by JUnit during `mvn test`. By doing this, a Kodtest-server is started on the configured port (default 8080) and access is enabled for anyone who authenticates with 'apiUser' and 'apiPassword!'.

If needed, change the default parameters used for tests in `com.infrasight.kodtest.TestVariables`.

- API_PORT
	- Which port the API server will listen on (default: 8080)
- API_USER
	- The API user used for auth (default: apiUser)
- API_PASSWORD
	- The API password used for auth (default: apiPassword!)
	
We expect that you submit your solutions as JUnit tests which we can evaluate by running `mvn test`.